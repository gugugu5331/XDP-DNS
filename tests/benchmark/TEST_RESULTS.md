# XDP DNS å¨èƒåˆ†æç³»ç»Ÿ - æµ‹è¯•ç»“æœæŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ

- **CPU**: 13th Gen Intel(R) Core(TM) i7-1360P (16 cores)
- **å†…æ ¸**: Linux 5.15+
- **Go**: 1.21+
- **æµ‹è¯•æ—¶é—´**: 2025-12-02

## æµ‹è¯•æ¦‚è§ˆ

### âœ… ç¼–è¯‘æµ‹è¯•

| ç»„ä»¶ | çŠ¶æ€ | å¤§å° |
|------|------|------|
| BPF ç¨‹åº | âœ… æˆåŠŸ | 18 KB |
| Go ç¨‹åº | âœ… æˆåŠŸ | 12 MB |
| è§„åˆ™åŠ è½½ | âœ… æˆåŠŸ | 6 æ¡è§„åˆ™ |

### âœ… å¨èƒæ£€æµ‹åŠŸèƒ½æµ‹è¯•

ä½¿ç”¨ dnsperf æŸ¥è¯¢æ–‡ä»¶ï¼ˆ36 æ¡æŸ¥è¯¢ï¼‰è¿›è¡Œæµ‹è¯•ï¼š

| ç±»åˆ« | æ•°é‡ | ç™¾åˆ†æ¯” | è¯´æ˜ |
|------|------|--------|------|
| **å¨èƒæµé‡ (BLOCK)** | 9 | 25% | æ¶æ„åŸŸåè¢«æˆåŠŸé˜»æ­¢ |
| **å¯ç–‘æµé‡ (LOG)** | 27 | 75% | å¯ç–‘æŸ¥è¯¢è¢«è®°å½• |
| **æ­£å¸¸æµé‡ (ALLOW)** | 0 | 0% | (æµ‹è¯•æ•°æ®ç‰¹æ„é€‰æ‹©) |

#### æ£€æµ‹åˆ°çš„å¨èƒåŸŸå

- âœ… `c2.malware.com` - æ¶æ„è½¯ä»¶ C2 æœåŠ¡å™¨
- âœ… `bot.botnet.net` - åƒµå°¸ç½‘ç»œ
- âœ… `phish.phishing.net` - é’“é±¼ç½‘ç«™
- âœ… `hack.malicious.org` - æ¶æ„åŸŸå
- âœ… `payload.ransomware.io` - å‹’ç´¢è½¯ä»¶
- âœ… `ad.doubleclick.net` - å¹¿å‘Šè¿½è¸ª
- âœ… `tracker.googlesyndication.com` - å¹¿å‘Šè¿½è¸ª
- âœ… `pixel.googleadservices.com` - å¹¿å‘Šè¿½è¸ª
- âœ… `stats.google-analytics.com` - ç»Ÿè®¡è¿½è¸ª

#### æ£€æµ‹åˆ°çš„å¯ç–‘æŸ¥è¯¢

- âš ï¸ TXT æŸ¥è¯¢: `tunnel.example.com`, `exfil.test.com`, `data.covert.org`
- âš ï¸ ANY æŸ¥è¯¢: `secret.hidden.net`
- âš ï¸ åŠ¨æ€ DNS: `host1.dyndns.org`, `server.no-ip.com`, `mypc.ddns.net`

### âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

#### å¨èƒæ£€æµ‹æ€§èƒ½

```
BenchmarkThreatDetectionDnsperfQueries-16
  4,823,470 æ¬¡æ“ä½œ
  1,099 ns/op      (~910K QPS)
  362 B/op         (å†…å­˜åˆ†é…)
  9 allocs/op      (åˆ†é…æ¬¡æ•°)
```

**æ€§èƒ½æŒ‡æ ‡:**
- **ååé‡**: ~910K QPSï¼ˆå•æ ¸ï¼‰
- **å»¶è¿Ÿ**: 1.1 Âµs/æŸ¥è¯¢
- **å†…å­˜æ•ˆç‡**: 362 å­—èŠ‚/æŸ¥è¯¢

#### é¢„æœŸ XDP æ€§èƒ½

åŸºäº XDP é›¶æ‹·è´æ¶æ„ï¼Œå®é™…è¿è¡Œæ—¶æ€§èƒ½ï¼š

| æ¨¡å¼ | é¢„æœŸ QPS | è¯´æ˜ |
|------|----------|------|
| å•æ ¸ | 1-2M | ç”¨æˆ·æ€å¨èƒæ£€æµ‹ |
| 4æ ¸ | 3-6M | å¹¶è¡Œå¤„ç† |
| 8æ ¸ | 5-10M | é«˜å¹¶å‘åœºæ™¯ |

**XDP å±‚æ€§èƒ½:**
- DNS ç«¯å£è¿‡æ»¤: < 100 ns
- bpf_redirect: é›¶æ‹·è´ï¼Œ< 50 ns
- AF_XDP è¯»å–: é›¶æ‹·è´ï¼Œ< 100 ns

## ç³»ç»Ÿæ”¯æŒæ£€æŸ¥

### âœ… é€šè¿‡çš„æ£€æŸ¥é¡¹

1. âœ… å†…æ ¸ç‰ˆæœ¬ >= 5.4
2. âœ… Root æƒé™å¯ç”¨
3. âœ… BPF æ–‡ä»¶ç³»ç»Ÿå·²æŒ‚è½½
4. âœ… clang ç¼–è¯‘å™¨å·²å®‰è£…
5. âœ… LLVM å·¥å…·é“¾å·²å®‰è£…
6. âœ… bpftool å·²å®‰è£…
7. âœ… dnsperf å·²å®‰è£…

### ğŸ“Š ç½‘å¡ä¿¡æ¯

- **é»˜è®¤ç½‘å¡**: eth0
- **XDP æ¨¡å¼**: å¾…å®é™…æµ‹è¯•ç¡®è®¤ï¼ˆdriver/generic/offloadï¼‰
- **å†…å­˜é™åˆ¶**: 996 MBï¼ˆè¶³å¤Ÿï¼‰

## æµ‹è¯•å‘½ä»¤

### åŠŸèƒ½æ¼”ç¤ºæµ‹è¯•

```bash
./tests/benchmark/demo_test.sh
```

### å¨èƒæ£€æµ‹é€»è¾‘æµ‹è¯•

```bash
make test-threat
# æˆ–
cd tests/benchmark && go test -v -run TestThreatDetection
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```bash
cd tests/benchmark && go test -bench=. -benchtime=3s
```

### XDP å®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦ rootï¼‰

```bash
# 1. æ£€æŸ¥æ”¯æŒ
sudo make test-xdp-setup

# 2. å¿«é€Ÿæµ‹è¯•ï¼ˆ10ç§’ï¼‰
sudo make test-xdp-quick INTERFACE=eth0

# 3. å®Œæ•´æµ‹è¯•ï¼ˆ30ç§’ï¼‰
sudo make test-xdp-full INTERFACE=eth0
```

### dnsperf æµé‡ç”Ÿæˆ

```bash
# å‘å…¬å…± DNS æœåŠ¡å™¨å‘é€æŸ¥è¯¢ï¼ˆXDP ç³»ç»Ÿå¯ä»¥æ•è·ï¼‰
./tests/benchmark/run_dnsperf.sh 8.8.8.8 30 1000 5
```

## æµ‹è¯•æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `demo_test.sh` | åŠŸèƒ½æ¼”ç¤ºè„šæœ¬ |
| `test_full_flow.sh` | XDP å®Œæ•´æµç¨‹æµ‹è¯• |
| `run_dnsperf.sh` | dnsperf æµé‡ç”Ÿæˆ |
| `check_xdp_support.sh` | XDP æ”¯æŒæ£€æŸ¥ |
| `dnsperf_queries.txt` | DNS æŸ¥è¯¢æ•°æ® |
| `threat_detection_test.go` | å¨èƒæ£€æµ‹å•å…ƒæµ‹è¯• |

## ç»“è®º

### âœ… åŠŸèƒ½å®Œæ•´æ€§

- DNS è§£æ: âœ… æ­£å¸¸
- å¨èƒæ£€æµ‹: âœ… å‡†ç¡®è¯†åˆ« 9 ç§å¨èƒ
- å¯ç–‘æµé‡æ£€æµ‹: âœ… è®°å½• 27 ç§å¯ç–‘æŸ¥è¯¢
- è§„åˆ™å¼•æ“: âœ… æ”¯æŒç²¾ç¡®åŒ¹é…å’Œé€šé…ç¬¦
- æ€§èƒ½: âœ… ~910K QPSï¼ˆçº¯ Goï¼‰

### ğŸš€ XDP ä¼˜åŠ¿

1. **é›¶æ‹·è´**: AF_XDP å…±äº«å†…å­˜ï¼Œæ— æ•°æ®å¤åˆ¶
2. **å†…æ ¸æ—è·¯**: ç»•è¿‡å®Œæ•´ç½‘ç»œæ ˆ
3. **ä½å»¶è¿Ÿ**: ç½‘å¡é©±åŠ¨å±‚å¤„ç†ï¼Œ< 1Âµs
4. **é«˜åå**: æ”¯æŒç™¾ä¸‡çº§ PPS

### ğŸ“ˆ æ”¹è¿›å»ºè®®

1. ä¿®å¤ `suspicious-tunnel` è§„åˆ™é€»è¾‘ï¼ˆåº”åªåŒ¹é… TXT/ANYï¼‰
2. å¢åŠ æ›´å¤šå¨èƒåŸŸååº“
3. å®ç° DGA åŸŸåæ£€æµ‹
4. æ·»åŠ  DNS éš§é“æµé‡ç‰¹å¾åˆ†æ

## å‚è€ƒæ–‡æ¡£

- [QUICKSTART_XDP_TEST.md](../../QUICKSTART_XDP_TEST.md) - å¿«é€Ÿå¼€å§‹
- [XDP_TESTING_GUIDE.md](../../docs/XDP_TESTING_GUIDE.md) - è¯¦ç»†æµ‹è¯•æŒ‡å—
- [README.md](../../README.md) - ç³»ç»Ÿæ¦‚è¿°


# XDP DNS Filter 配置文件

# 网络接口配置
interface: eth0

# 多队列配置
queue_start: 0      # 起始队列 ID
queue_count: 4      # 使用的队列数量 (支持多 RX 队列)

# BPF 程序路径
bpf_path: bpf/xdp_dns_filter_bpfel.o

# AF_XDP Socket 配置 (每个队列的配置)
xdp:
  num_frames: 4096
  frame_size: 2048
  fill_ring_size: 2048
  comp_ring_size: 2048
  rx_ring_size: 2048
  tx_ring_size: 2048
  zero_copy: false    # 是否使用零拷贝模式

# Worker 配置
workers:
  num_workers: 0         # 0 表示使用 CPU 核心数
  workers_per_queue: 2   # 每个队列的 worker 数量
  batch_size: 64

# DNS 配置
dns:
  listen_ports:
    - 53
    - 5353
  upstream_servers:
    - 8.8.8.8:53
    - 8.8.4.4:53
  cache_size: 10000
  cache_ttl: 300s

# 响应配置
response:
  enabled: true         # 是否启用响应发送
  mode: "block_only"    # 响应模式: "block_only"(仅阻止), "all"(所有请求都响应，用于测试)
  block_response: true  # 对阻止的请求是否发送响应
  nxdomain: true        # 返回 NXDOMAIN (true) 或 REFUSED (false)

# 过滤规则配置
rules_path: configs/rules.yaml

# 监控配置
metrics:
  enabled: true
  listen: ":9090"
  path: /metrics

# 日志配置
logging:
  enabled: true     # 是否启用日志 (false = 完全关闭)
  level: info       # 日志级别: debug, info, warn, error
  format: text      # 日志格式: json, text
  output: stdout    # 输出: stdout, stderr, 或文件路径

# 性能调优配置 (用于测试)
performance:
  single_core: false    # 单核模式 (仅使用1个队列，用于性能基准测试)
  cpu_affinity: -1      # CPU 亲和性 (-1 = 不设置，0-N = 绑定到指定核心)
  busy_poll: false      # 忙轮询模式 (降低延迟但增加CPU使用)
  disable_log: false    # 禁用所有日志输出 (用于极限性能测试)